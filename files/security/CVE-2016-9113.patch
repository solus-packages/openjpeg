From b5039e257dafbb58ddc60e78c887dd45de62e19d Mon Sep 17 00:00:00 2001
From: Pierre-Yves <pyu@riseup.net>
Date: Thu, 10 Aug 2017 11:43:01 +0200
Subject: [PATCH] CVE-2016-9113

Signed-off-by: Pierre-Yves <pyu@riseup.net>
---
 src/bin/jp2/convertbmp.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/src/bin/jp2/convertbmp.c b/src/bin/jp2/convertbmp.c
index b49e7a0..3356b23 100644
--- a/src/bin/jp2/convertbmp.c
+++ b/src/bin/jp2/convertbmp.c
@@ -845,6 +845,11 @@ int imagetobmp(opj_image_t * image, const char *outfile)
             && image->comps[0].sgnd == image->comps[1].sgnd
             && image->comps[1].sgnd == image->comps[2].sgnd) {
 
+        if (!image->comps[0].data || !image->comps[1].data || !image->comps[2].data) {
+            fprintf(stderr, "ERROR -> Missing image data in input file\n");
+            return 1;
+        }
+
         /* -->> -->> -->> -->>
         24 bits color
         <<-- <<-- <<-- <<-- */
@@ -974,6 +979,11 @@ int imagetobmp(opj_image_t * image, const char *outfile)
         fclose(fdest);
     } else {            /* Gray-scale */
 
+        if (!image->comps[0].data) {
+            fprintf(stderr, "ERROR -> Missing image data in input file\n");
+            return 1;
+        }
+
         /* -->> -->> -->> -->>
         8 bits non code (Gray scale)
         <<-- <<-- <<-- <<-- */
-- 
2.13.4

