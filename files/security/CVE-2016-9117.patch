From 5f5786f317360df4eca43dead1a5988274e10944 Mon Sep 17 00:00:00 2001
From: Hans Petter Jansson <hpj@cl.no>
Date: Wed, 21 Dec 2016 05:18:21 +0100
Subject: [PATCH 11/11] CVE-2016-9117

---
 src/bin/jp2/convert.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/bin/jp2/convert.c b/src/bin/jp2/convert.c
index cb70839..16ce37d 100644
--- a/src/bin/jp2/convert.c
+++ b/src/bin/jp2/convert.c
@@ -1489,6 +1489,15 @@ int imagetopgx(opj_image_t * image, const char *outfile)
   FILE *fdest = NULL;
 
   for (compno = 0; compno < image->numcomps; compno++) 
+  {
+    if (!image->comps[compno].data)
+    {
+      fprintf(stderr, "imagetopgx: Missing image data in input file\n");
+      goto fin;
+    }
+  }
+
+  for (compno = 0; compno < image->numcomps; compno++) 
     {
     opj_image_comp_t *comp = &image->comps[compno];
     char bname[256]; /* buffer for name */
-- 
1.8.4.5

